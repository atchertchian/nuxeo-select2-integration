<div xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:ui="http://java.sun.com/jsf/facelets">

  <c:set var="namespace" value="#{widget.properties.namespace}" />
  <c:set var="inlinejs" value="#{widget.properties.inlinejs}" />
  <c:set var="jsonParams" value="#{select2ActionBean.encodeParameters(widget)}"/>

  <c:if test="#{widget.mode == 'view' }">
    <c:if test="#{!select2ActionBean.isMultiSelection(widget)}">
      <h:outputText value="#{select2ActionBean.resolveSingleReferenceLabel(field_0,widget.properties['initOperationId'],widget.properties['labelProperty'])}"/>
    </c:if>
    <c:if test="#{select2ActionBean.isMultiSelection(widget)}">
      <ui:repeat value="#{select2ActionBean.resolveMultipleReferenceLabels(field_0,widget.properties['initOperationId'],widget.properties['labelProperty'])}" var="label">
        <h:outputText value="#{label}"/><br/>
      </ui:repeat>
    </c:if>
  </c:if>

  <c:if test="#{widget.mode == 'edit' }">

   <c:if test="#{select2ActionBean.mustIncludeResources()}">
     <script src="/nuxeo/scripts/select2/select2.js"/>
     <script src="/nuxeo/scripts/select2/nuxeo-select2.js"/>
   </c:if>

   <c:if test="#{inlinejs != null }">
     <script><h:outputText value="#{inlinejs}" escape="false"/></script>
   </c:if>

   <c:if test="#{!select2ActionBean.isMultiSelection(widget)}">
     <h:inputHidden id="#{widget.id}-select2" value="#{field_0}"/>
     <input type="hidden" id="#{widget.id}-select2-init" value="#{select2ActionBean.resolveSingleReference(field_0,widget.properties['initOperationId'],widget.properties['documentSchemas'])}"/>
   </c:if>

   <c:if test="#{select2ActionBean.isMultiSelection(widget)}">
     <h:inputHidden id="#{widget.id}-select2" value="#{field_0}">
       <f:converter converterId="select2Converter"></f:converter>
     </h:inputHidden>
     <input type="hidden" id="#{widget.id}-select2-init" value="#{select2ActionBean.resolveMultipleReferences(field_0,widget.properties['initOperationId'],widget.properties['documentSchemas'])}"/>
   </c:if>

   <input type="hidden" id="#{widget.id}-select2-params" value="#{jsonParams}"/>
   <h:message for="#{widget.id}-select2" styleClass="errorMessage" />
  </c:if>

</div>
